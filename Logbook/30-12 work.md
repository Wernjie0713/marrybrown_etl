# 30-12 Work Log - Product Mix Investigation (Order Tables)

## Context

Continuing Product Mix discrepancy investigation. LocationPrice + RecipeSummary were added, but large mismatches remain. Next step is to pull Order-related tables to validate order-level pricing, packaging fee logic, and source/category mapping.

## Findings

Tables with data (likely relevant):

- `COM_5013.APP_4_ORDER`
- `COM_5013.APP_4_ORDERITEM`
  - Has `ORDER_SOURCE`, `DELIVERY_TYPE`, `ITEM_CATEGORY`, `BOOL_ISPACKAGE`, `DOUBLE_PRICE`, `DOUBLE_ENTER_PRICE`, etc.
  - Could explain packaging fee qty differences and which lines are considered reportable.

Menu/category mapping:

- `COM_5013.APP_4_MENUPROFILE`
- `COM_5013.APP_4_MENUPROFILEMAPPING`
- `COM_5013.APP_4_MENUMAINCATEGORY`
- `COM_5013.APP_4_MENUSUBCATEGORY`
- `COM_5013.APP_4_MENUITEMMODIFIER`
- `COM_5013.APP_4_MENUITEMOUTOFSTOCK`
  - Likely defines Category/Group Name seen in Excel and can be used to filter out component items.

Package + promo:

- `COM_5013.APP_4_PACKAGE`
- `COM_5013.APP_4_PROMOITEM`
- `COM_5013.APP_4_PROMORULE`
  - May explain bundled items and why component lines appear in API but not Excel.

Price history / scheme:

- `COM_5013.APP_4_PRICELOG` (contains `PRICE_SCHEME_ENUM`)
- `COM_5013.APP_4_PRICECHANGEITEM`
  - Might indicate which price tier the report uses per date/sales type.

Customer price scheme:

- `COM_5013.APP_4_CUSTOMER` (has `PRICE_SCHEME`, `DEFAULT_SALES_TYPE`)
- `COM_5013.APP_4_CUSTOMERTYPE` (has `INT_PRICE_SCHEME`, `DEFAULT_SALES_TYPE`)
  - Could influence which price tier is applied.

Tables confirmed empty in Xilnex:

- `COM_5013.APP_4_PRODUCTDICTIONARYMAPPING`
- `COM_5013.APP_4_COMBOITEM`
- `COM_5013.APP_4_MENUDEPARTMENT`
- `COM_5013.APP_4_CLIENTPRICE`
- `COM_5013.APP_4_CLIENTGROUPPRICE`

## Next Actions

- Add `APP_4_ORDER` and `APP_4_ORDERITEM` to the replica schema list.
- Create migrations for `dbo.com_5013_APP_4_ORDER` and `dbo.com_5013_APP_4_ORDERITEM`.
- Replicate order tables for validation against Product Mix output.

Order tables 2025 check:

- Ran `replicate_all_sales_data.py` for APP_4_ORDER + APP_4_ORDERITEM (2025-01-01 to 2025-10-31) and every month returned 0 rows.
- Checked Xilnex source counts/date ranges:
- `COM_5013.APP_4_ORDER`: 4 rows total, `DATETIME__ORDER_DATE` range `2020-03-23` to `2020-09-30`.
- `COM_5013.APP_4_ORDERITEM`: 3 rows total, `ORDER_DATE` is `varchar` (values like `23/03/2020`).
- Result: no 2025 data in either table, so not useful for Product Mix 2025 replication.

Menu tables date signal check:

- `COM_5013.APP_4_MENUPROFILE`: `DATETIME_MODIFIED` has 2025 values (max `2025-12-29`).
- `COM_5013.APP_4_MENUITEMOUTOFSTOCK`: `DATETIME__DATESTART`/`DATETIME__DATEEND` have 2025 values (max `2025-07-13` / `2025-12-31`).
- No date columns (treat as reference full-table): `APP_4_MENUPROFILEMAPPING`, `APP_4_MENUMAINCATEGORY`, `APP_4_MENUSUBCATEGORY`, `APP_4_MENUITEMMODIFIER`.
